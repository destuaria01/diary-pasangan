<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Diary Pasangan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#22c55e">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#dcfce7,#bbf7d0);
      color: #064e3b;
    }
    .card {
      background: white;
      margin: 12px;
      padding: 12px;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    h1,h2 { text-align:center; }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: #22c55e;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #86efac;
    }
    img { width: 100%; border-radius: 10px; margin-top: 6px; }
    .hidden { display: none; }
    .log {
      font-size: 12px;
      border-top: 1px solid #bbf7d0;
      margin-top: 6px;
      padding-top: 6px;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
  <h1>Diary Pasangan</h1>
  <label>Masuk sebagai</label>
  <select id="loginAs">
    <option value="A">Pasangan A</option>
    <option value="B">Pasangan B</option>
  </select>

  <label>PIN</label>
  <input id="pin" type="password">

  <button onclick="login()">Masuk</button>
  <p>PIN awal A = 1111 | B = 2222</p>
</div>

<!-- APLIKASI -->
<div id="app" class="hidden">

  <div class="card">
    <h2>Nama Pasangan</h2>
    <input id="nameA" placeholder="Nama Pasangan A">
    <input id="nameB" placeholder="Nama Pasangan B">
    <button onclick="saveNames()">Simpan Nama</button>
  </div>

  <div class="card">
    <h2>Absensi Keluar & Pulang</h2>
    <select id="absenWho">
      <option value="A">Pasangan A</option>
      <option value="B">Pasangan B</option>
    </select>
    <select id="absenType">
      <option value="Keluar">Keluar</option>
      <option value="Pulang">Pulang</option>
    </select>
    <button onclick="absen()">Simpan Absensi</button>
    <div id="absenList"></div>
  </div>

  <div class="card">
    <h2>Foto Aktivitas</h2>
    <select id="photoWho">
      <option value="A">Pasangan A</option>
      <option value="B">Pasangan B</option>
    </select>
    <input id="photoFile" type="file" accept="image/*" capture="environment">
    <button onclick="uploadPhoto()">Upload</button>
  </div>

  <div class="card">
    <h2>Galeri Aktivitas</h2>
    <div id="gallery"></div>
  </div>

  <button onclick="logout()">Keluar</button>

</div>

<script>
const KEY_ABSEN = "diary_absen";
const KEY_PHOTO = "diary_photo";
const KEY_NAMES = "diary_names";

let absensi = JSON.parse(localStorage.getItem(KEY_ABSEN)) || [];
let photos = JSON.parse(localStorage.getItem(KEY_PHOTO)) || [];
let names = JSON.parse(localStorage.getItem(KEY_NAMES)) || {A:"Pasangan A", B:"Pasangan B"};

function login(){
  const who = document.getElementById("loginAs").value;
  const pin = document.getElementById("pin").value;

  if(
    (who === "A" && pin === "1111") ||
    (who === "B" && pin === "2222")
  ){
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
  } else {
    alert("PIN salah!");
  }
}

function logout(){
  document.getElementById("login").classList.remove("hidden");
  document.getElementById("app").classList.add("hidden");
}

function saveNames(){
  names.A = nameA.value || "Pasangan A";
  names.B = nameB.value || "Pasangan B";
  localStorage.setItem(KEY_NAMES, JSON.stringify(names));
  alert("Nama tersimpan");
}

function absen(){
  const who = document.getElementById("absenWho").value;
  const type = document.getElementById("absenType").value;
  const t = new Date().toLocaleString();

  absensi.push({id:Date.now(), who, type, time:t});
  localStorage.setItem(KEY_ABSEN, JSON.stringify(absensi));
  renderAbsen();
}

function renderAbsen(){
  absenList.innerHTML = "";
  absensi.slice().reverse().forEach(a=>{
    const d = document.createElement("div");
    d.className = "log";
    d.textContent = `${names[a.who]} - ${a.type} - ${a.time}`;
    absenList.appendChild(d);
  });
}

function uploadPhoto(){
  const f = photoFile.files[0];
  if(!f) return alert("Pilih foto dulu");

  const who = photoWho.value;
  const r = new FileReader();

  r.onload = ()=>{
    photos.push({id:Date.now(), who, photo:r.result});
    localStorage.setItem(KEY_PHOTO, JSON.stringify(photos));
    renderPhotos();
  };

  r.readAsDataURL(f);
}

function renderPhotos(){
  gallery.innerHTML = "";
  photos.slice().reverse().forEach(p=>{
    const img = document.createElement("img");
    img.src = p.photo;
    gallery.appendChild(img);
  });
}

nameA.value = names.A;
nameB.value = names.B;
renderAbsen();
renderPhotos();
</script>

</body>
</html>
